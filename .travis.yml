dist: xenial

language: node_js

node_js: '8.9'

env:
  global:
  - ELECTRON_BUILDER_ALLOW_UNRESOLVED_DEPENDENCIES=true
  - ELECTRON_CACHE=$HOME/.cache/electron
  - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

branches:
  except:
  - gh-pages-src

before_script:
  - yarn build:modules
  - yarn test

script:
  - if [[ "$TRAVIS_BRANCH" == "stable" ]]; then yarn dist:ci; else yarn build:prod; fi

cache:
  yarn: true
  directories:
  - node_modules
  - '$HOME/.electron'
  - '$HOME/.cache'

after_success:
  - yarn test:coverage
